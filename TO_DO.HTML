<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>To‚ÄëDo List & Task Manager</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --muted:#6b7280; --accent:#4f46e5;
      --low:#10b981; --medium:#f59e0b; --high:#ef4444; --glass: rgba(255,255,255,0.6);
      --radius:12px; --shadow: 0 6px 18px rgba(12,15,30,0.06);
    }
    [data-theme="dark"]{
      --bg:#0b1220; --card:#0f1724; --muted:#9aa4b2; --accent:#7c3aed;
      --low:#16a34a; --medium:#d97706; --high:#ef4444; --glass: rgba(255,255,255,0.02);
      --shadow: 0 8px 22px rgba(2,6,23,0.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg), #e9eefb); padding:28px; color:var(--text,#0b1220);
      transition: background .25s ease;
    }
    .app{
      max-width:1000px; margin:0 auto; display:grid; grid-template-columns: 360px 1fr; gap:20px; align-items:start;
    }
    .panel{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px}
    header{display:flex; justify-content:space-between; gap:12px; align-items:center; margin-bottom:14px}
    h1{font-size:20px; margin:0}
    .sub{color:var(--muted); font-size:13px}

    /* left column */
    .left .controls{display:flex; gap:8px; margin-bottom:12px}
    .btn{display:inline-flex; align-items:center; gap:8px; border:0; padding:10px 12px; border-radius:10px; cursor:pointer; background:var(--glass)}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#6366f1); color:white}
    .filters{display:flex; gap:8px; margin-bottom:12px}
    .tab{padding:8px 10px; border-radius:8px; cursor:pointer; color:var(--muted)}
    .tab.active{background:linear-gradient(90deg, rgba(99,102,241,0.12), rgba(79,70,229,0.08)); color:var(--accent); font-weight:600}

    /* search and stats */
    .search{display:flex; gap:8px; margin-bottom:12px}
    .search input{flex:1; padding:9px 10px; border-radius:10px; border:1px solid rgba(15,23,42,0.06)}
    .stats{display:flex; gap:10px; justify-content:space-between; margin-top:8px; font-size:13px}

    /* task list */
    .tasks{display:flex; flex-direction:column; gap:10px; max-height:70vh; overflow:auto; padding-right:6px}
    .task{display:flex; gap:12px; align-items:flex-start; padding:12px; border-radius:10px; transition:transform .18s ease, box-shadow .18s ease; border:1px solid rgba(15,23,42,0.04)}
    .task:hover{transform:translateY(-4px); box-shadow:0 8px 20px rgba(9,10,15,0.05)}
    .task .leftCol{display:flex; gap:12px; align-items:center}
    .checkbox{width:20px; height:20px; border-radius:6px; display:inline-grid; place-items:center; cursor:pointer; border:1px solid rgba(15,23,42,0.06)}
    .checkbox.checked{background:linear-gradient(90deg,var(--accent),#6366f1); color:white}
    .task .meta{flex:1}
    .title{font-weight:600}
    .desc{font-size:13px; color:var(--muted)}
    .metaSmall{display:flex; gap:8px; align-items:center; margin-top:8px; font-size:12px}
    .pill{padding:6px 8px; border-radius:999px; font-size:12px}
    .priority.low{background:rgba(16,185,129,0.12); color:var(--low)}
    .priority.medium{background:rgba(245,158,11,0.08); color:var(--medium)}
    .priority.high{background:rgba(239,68,68,0.08); color:var(--high)}

    .actions{display:flex; gap:8px}
    .iconBtn{background:transparent; border:0; cursor:pointer; padding:8px; border-radius:8px}
    .small{font-size:13px}

    /* right column */
    .right header{margin-bottom:10px}
    .empty{
      display:grid; place-items:center; padding:40px; color:var(--muted); border-radius:10px; border:1px dashed rgba(15,23,42,0.04)
    }

    /* modal form */
    .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(2,6,23,0.4); z-index:60}
    .modal.show{display:grid}
    .modalCard{width:min(720px,94vw); background:var(--card); padding:18px; border-radius:12px; box-shadow:var(--shadow)}
    .formRow{display:flex; gap:10px}
    .formRow .col{flex:1}
    label{display:block; font-size:13px; margin-bottom:6px}
    input[type=text], input[type=date], textarea, select{width:100%; padding:10px; border-radius:8px; border:1px solid rgba(15,23,42,0.06)}
    textarea{min-height:80px}
    .footer{display:flex; justify-content:space-between; gap:12px; margin-top:12px}

    /* responsive */
    @media (max-width:900px){
      .app{grid-template-columns:1fr;}
      .left{order:2}
      .right{order:1}
    }
    /* small touches */
    .due.urgent{color:var(--high); font-weight:700}
    .completed .title{text-decoration:line-through; opacity:0.7}

  </style>
</head>
<body>
  <div class="app" id="app" data-theme="light">
    <div class="panel left">
      <header>
        <div>
          <h1>Tasks</h1>
          <div class="sub">Manage your tasks ‚Äî quick, simple, persistent</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="darkToggle" class="btn" title="Toggle dark mode">üåô</button>
          <button id="openAdd" class="btn primary">+ New Task</button>
        </div>
      </header>

      <div class="search">
        <input id="searchInput" placeholder="Search tasks by title or description...">
        <select id="sortSelect" class="btn" title="Sort">
          <option value="new">Newest</option>
          <option value="old">Oldest</option>
          <option value="dueAsc">Due soon</option>
          <option value="dueDesc">Due later</option>
        </select>
      </div>

      <div class="filters" role="tablist">
        <div class="tab active" data-filter="all">All</div>
        <div class="tab" data-filter="pending">Pending</div>
        <div class="tab" data-filter="completed">Completed</div>
      </div>

      <div class="tasks" id="taskList" aria-live="polite"></div>

      <div class="stats">
        <div id="countAll">All: 0</div>
        <div id="countPending">Pending: 0</div>
        <div id="countCompleted">Completed: 0</div>
      </div>
    </div>

    <div class="panel right">
      <header>
        <h2 style="margin:0">Details</h2>
        <div class="sub">Click a task to see details & quick actions</div>
      </header>
      <div id="details" class="empty">No task selected ‚Äî select a task to see details</div>
    </div>
  </div>

  <!-- Modal form for add/edit -->
  <div class="modal" id="modal">
    <div class="modalCard">
      <h3 id="modalTitle">New Task</h3>
      <form id="taskForm">
        <input type="hidden" id="taskId">
        <div class="formRow" style="margin-bottom:10px">
          <div class="col">
            <label for="title">Title</label>
            <input id="title" type="text" required placeholder="Task title">
          </div>
          <div class="col" style="max-width:180px">
            <label for="due">Due date</label>
            <input id="due" type="date">
          </div>
        </div>

        <div style="margin-bottom:10px">
          <label for="desc">Description (optional)</label>
          <textarea id="desc" placeholder="Describe the task..."></textarea>
        </div>

        <div class="formRow">
          <div class="col">
            <label for="priority">Priority</label>
            <select id="priority">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div class="col">
            <label for="status">Status</label>
            <select id="status">
              <option value="pending">Pending</option>
              <option value="completed">Completed</option>
            </select>
          </div>
        </div>

        <div class="footer">
          <div style="display:flex;gap:8px">
            <button type="button" class="btn" id="cancelBtn">Cancel</button>
            <button type="submit" class="btn primary" id="saveBtn">Save Task</button>
          </div>
          <div class="sub small">Fields marked required must be filled.</div>
        </div>
      </form>
    </div>
  </div>

  <script>
    /* -------------------------- Modular JS To-Do App -------------------------- */
    (function(){
      /* ---------- Storage + Constants ---------- */
      const STORAGE_KEY = 'todo.tasks.v1';
      const THEME_KEY = 'todo.theme.v1';

      /* ---------- Utility helpers ---------- */
      function qs(sel, root=document){ return root.querySelector(sel); }
      function qsa(sel, root=document){ return Array.from(root.querySelectorAll(sel)); }
      function byId(id){ return document.getElementById(id); }
      function uid(){ return 't_'+Date.now()+'_'+Math.floor(Math.random()*9999); }
      function parseDateISO(d){ return d ? new Date(d) : null }
      function formatDate(d){ if(!d) return '‚Äî'; const dt=new Date(d); return dt.toLocaleDateString(); }

      /* ---------- App state ---------- */
      let tasks = [];
      let filter = 'all';
      let searchTerm = '';
      let sortBy = 'new';

      /* ---------- DOM refs ---------- */
      const taskList = byId('taskList');
      const details = byId('details');
      const modal = byId('modal');
      const form = byId('taskForm');
      const modalTitle = byId('modalTitle');
      const darkToggle = byId('darkToggle');
      const appRoot = byId('app');

      /* ---------- Persistence ---------- */
      function loadTasks(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          tasks = raw ? JSON.parse(raw) : [];
        }catch(e){ tasks = []; console.error('Failed to parse tasks', e); }
      }
      function saveTasks(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }

      /* ---------- Theme ---------- */
      function loadTheme(){
        const t = localStorage.getItem(THEME_KEY) || 'light';
        setTheme(t, false);
      }
      function setTheme(t, persist=true){
        appRoot.setAttribute('data-theme', t);
        document.body.setAttribute('data-theme', t);
        darkToggle.textContent = t === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        if(persist) localStorage.setItem(THEME_KEY, t);
      }

      /* ---------- CRUD operations ---------- */
      function addTask(payload){
        const task = Object.assign({
          id: uid(), title:'', description:'', due:null, priority:'medium', status:'pending', createdAt: new Date().toISOString()
        }, payload);
        tasks.unshift(task);
        saveTasks(); renderTasks();
        return task;
      }
      function updateTask(id, patch){
        const i = tasks.findIndex(t=>t.id===id);
        if(i<0) return false;
        tasks[i] = Object.assign({}, tasks[i], patch);
        saveTasks(); renderTasks();
        return true;
      }
      function deleteTask(id){
        tasks = tasks.filter(t=>t.id!==id);
        saveTasks(); renderTasks();
      }
      function toggleComplete(id){
        const t = tasks.find(x=>x.id===id); if(!t) return;
        t.status = t.status === 'completed' ? 'pending' : 'completed';
        saveTasks(); renderTasks();
      }

      /* ---------- Rendering ---------- */
      function countByStatus(){
        const all = tasks.length;
        const completed = tasks.filter(t=>t.status==='completed').length;
        const pending = all - completed;
        byId('countAll').textContent = `All: ${all}`;
        byId('countCompleted').textContent = `Completed: ${completed}`;
        byId('countPending').textContent = `Pending: ${pending}`;
      }

      function renderTasks(){
        countByStatus();
        // filter, search, sort
        let list = tasks.slice();

        if(filter === 'completed') list = list.filter(t=>t.status==='completed');
        if(filter === 'pending') list = list.filter(t=>t.status!=='completed');
        if(searchTerm) list = list.filter(t => (t.title||'').toLowerCase().includes(searchTerm) || (t.description||'').toLowerCase().includes(searchTerm));

        if(sortBy === 'new') list.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
        if(sortBy === 'old') list.sort((a,b)=> new Date(a.createdAt) - new Date(b.createdAt));
        if(sortBy === 'dueAsc') list.sort((a,b)=> (a.due||'9999') > (b.due||'9999') ? 1: -1);
        if(sortBy === 'dueDesc') list.sort((a,b)=> (a.due||'0000') > (b.due||'0000') ? 1: -1);

        // render
        taskList.innerHTML = '';
        if(list.length===0){ taskList.innerHTML = '<div class="empty">No tasks found</div>'; details.innerHTML = '<div class="empty">No task selected ‚Äî select a task to see details</div>'; return; }

        list.forEach(t=>{
          const el = document.createElement('div'); el.className = 'task';
          if(t.status==='completed') el.classList.add('completed');

          el.innerHTML = `
            <div class="leftCol">
              <div class="checkbox ${t.status==='completed'?'checked':''}" data-id="${t.id}" title="Toggle complete">${t.status==='completed'?'‚úì':''}</div>
            </div>
            <div class="meta">
              <div style="display:flex;justify-content:space-between;gap:10px;align-items:center">
                <div>
                  <div class="title">${escapeHtml(t.title)}</div>
                  <div class="desc">${escapeHtml(t.description || '')}</div>
                </div>
                <div class="actions">
                  <div class="pill priority ${t.priority}">${capitalize(t.priority)}</div>
                  <button class="iconBtn small" data-id="${t.id}" data-action="edit">‚úèÔ∏è</button>
                  <button class="iconBtn small" data-id="${t.id}" data-action="delete">üóëÔ∏è</button>
                </div>
              </div>
              <div class="metaSmall">
                <div class="sub">Due: <span class="due ${isDueSoon(t.due)?'urgent':''}">${t.due?formatDate(t.due):'‚Äî'}</span></div>
                <div class="sub">Created: ${formatDate(t.createdAt)}</div>
              </div>
            </div>
          `;

          // event handlers
          const cb = el.querySelector('.checkbox'); cb.addEventListener('click', ()=>{ toggleComplete(t.id); showDetails(t.id); });
          el.querySelector('[data-action="edit"]').addEventListener('click', ()=> openEdit(t.id));
          el.querySelector('[data-action="delete"]').addEventListener('click', ()=>{ if(confirm('Delete this task?')) deleteTask(t.id); });
          el.addEventListener('click', (e)=>{ if(!e.target.closest('.iconBtn')) showDetails(t.id); });

          taskList.appendChild(el);
        });
      }

      /* ---------- Helpers for UI ---------- */
      function openAdd(){
        modalTitle.textContent = 'New Task';
        form.reset(); byId('taskId').value = '';
        byId('priority').value = 'medium'; byId('status').value = 'pending';
        showModal();
      }
      function openEdit(id){
        const t = tasks.find(x=>x.id===id); if(!t) return;
        modalTitle.textContent = 'Edit Task';
        byId('taskId').value = t.id;
        byId('title').value = t.title;
        byId('desc').value = t.description || '';
        byId('due').value = t.due || '';
        byId('priority').value = t.priority;
        byId('status').value = t.status;
        showModal();
      }
      function showModal(){ modal.classList.add('show'); }
      function closeModal(){ modal.classList.remove('show'); }

      function showDetails(id){
        const t = tasks.find(x=>x.id===id); if(!t) return;
        details.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:start;gap:12px">
            <div>
              <h3 style="margin:0">${escapeHtml(t.title)}</h3>
              <div class="sub">${t.description?escapeHtml(t.description):'<i>No description</i>'}</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px">
              <div class="pill priority ${t.priority}">${capitalize(t.priority)}</div>
              <div class="sub">Status: <strong>${capitalize(t.status)}</strong></div>
            </div>
          </div>
          <div style="margin-top:12px" class="metaSmall">
            <div>Created: ${formatDate(t.createdAt)}</div>
            <div>Due: ${t.due?formatDate(t.due):'‚Äî'}</div>
          </div>
          <div style="margin-top:14px;display:flex;gap:8px">
            <button class="btn" id="detailToggle">${t.status==='completed'?'Mark as pending':'Mark as completed'}</button>
            <button class="btn" id="detailEdit">Edit</button>
            <button class="btn" id="detailDelete">Delete</button>
          </div>
        `;
        byId('detailToggle').addEventListener('click', ()=>{ toggleComplete(t.id); showDetails(t.id); });
        byId('detailEdit').addEventListener('click', ()=> openEdit(t.id));
        byId('detailDelete').addEventListener('click', ()=>{ if(confirm('Delete this task?')){ deleteTask(t.id); details.innerHTML = '<div class="empty">No task selected ‚Äî select a task to see details</div>'; } });
      }

      /* ---------- Small utilities ---------- */
      function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }
      function capitalize(s){ return s ? s[0].toUpperCase() + s.slice(1) : s; }
      function isDueSoon(d){ if(!d) return false; const due = new Date(d); const now = new Date(); const diff = (due - now) / (1000*60*60*24); return diff <= 2 && diff >= -3650; }

      /* ---------- UI wiring ---------- */
      function attachEvents(){
        byId('openAdd').addEventListener('click', openAdd);
        byId('cancelBtn').addEventListener('click', ()=> closeModal());
        modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
        darkToggle.addEventListener('click', ()=>{ const t = appRoot.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'; setTheme(t); });
        byId('searchInput').addEventListener('input', (e)=>{ searchTerm = e.target.value.trim().toLowerCase(); renderTasks(); });
        byId('sortSelect').addEventListener('change', (e)=>{ sortBy = e.target.value; renderTasks(); });

        // tabs
        qsa('.tab').forEach(tab=> tab.addEventListener('click', ()=>{ qsa('.tab').forEach(x=>x.classList.remove('active')); tab.classList.add('active'); filter = tab.dataset.filter; renderTasks(); }));

        // form save
        form.addEventListener('submit', (ev)=>{
          ev.preventDefault();
          const id = byId('taskId').value;
          const payload = {
            title: byId('title').value.trim(),
            description: byId('desc').value.trim(),
            due: byId('due').value || null,
            priority: byId('priority').value,
            status: byId('status').value,
          };
          if(!payload.title){ alert('Please provide a task title'); return; }
          if(id){ // update
            updateTask(id, payload);
          } else { addTask(payload); }
          closeModal();
        });
      }

      /* ---------- Init ---------- */
      function init(){ loadTasks(); loadTheme(); attachEvents(); renderTasks();
        // expose quick sample if no tasks
        if(tasks.length===0){ addTask({title:'Welcome ‚Äî try adding a task', description:'This app stores tasks in localStorage. Edit / delete / mark complete.', priority:'low', due:null}); }
      }

      init();

      /* ----------------- end IIFE ----------------- */
    })();
  </script>
</body>
</html>
